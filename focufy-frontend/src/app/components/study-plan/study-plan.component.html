<div class="d-flex justify-content-center">
  <div class="container m-5 p-5">
    <div *ngIf="!isLoading">
      <div *ngIf="studyPlan">
        <div class="row mb-3">
          <div class="col">
            <h2 class="pb-3">Your current<br> study plan</h2>
            <p class="fs-5">
              <span class="btn btn-light border border-1 border-black rounded-0 text-uppercase fs-5">
                {{ studyPlan.shortTermGoal }}
              </span>
              is your proximal goal.
            </p>
          </div>
          <div class="col text-end">
            <p class="fs-3 mb-0">Welcome back, <span class="text-capitalize fw-bold">{{ user?.name }}</span></p>
            <a class="btn p-0" role="button" routerLink="/profile">
              <button class="text-uppercase btn btn-dark rounded-pill px-5 py-3 mt-1">
                check your profile <i class="bi bi-arrow-right ms-2"></i>
              </button>
            </a>
          </div>
        </div>

        <div class="accordion" id="studyPlanAccordion">
          <div *ngFor="let day of studyPlan.days; let i = index" class="accordion-item border-0 mb-4">
            <h2 class="accordion-header border-0" id="heading-{{ i }}">
              <button class="accordion-button rounded-0 text-black fs-6" type="button"
                [class.show]="isToday(day)" [attr.aria-expanded]="isToday(day)" data-bs-toggle="collapse"
                [attr.data-bs-target]="'#collapse-' + i" [attr.aria-controls]="'collapse-' + i">
                <b>{{ day.name }}</b> &nbsp; - {{day.date | date:'fullDate'}}
              </button>
            </h2>
            <div [id]="'collapse-' + i" class="accordion-collapse collapse" [attr.aria-labelledby]="'heading-' + i"
              [class.show]="isToday(day)" aria-labelledby="headingOne" data-bs-parent="#studyPlanAccordion">
              <div class="accordion-body p-4">

                <!-- Study Day -->
                <div *ngIf="day.type === 'StudyDay'" class="row single-day my-1 pt-3 pb-1">
                  <div class="col align-content-center px-5">
                    <h3 class="fw-bold fst-italic text-center">{{ day.name }} - Study</h3>
                    <p class="mantra-text text-center"> &ldquo;{{ day.mantra }}&rdquo; </p>
                  </div>
                  <div class="col">
                    <div *ngIf="day.activitySessions && day.activitySessions.length > 0">
                      <div *ngFor="let session of day.activitySessions.slice().sort(compareSessions)">
                        <div [ngClass]="{
                          'session-study': session.activitySessionType === 'STUDY',
                          'session-rest': session.activitySessionType === 'REST',
                          'session-fun': session.activitySessionType === 'FUN'
                        }" class="activity-session p-3">
                          <!-- [style.height.px]="session.duration * 30" -->
                          <p class="my-0 fs-4"><i></i> {{ session.activitySessionType }}</p>
                          <div class="row sessiondetails">
                            <div class="col d-flex">
                              <span class="me-2 my-0 d-flex"><i class="d-flex align-items-center">from about</i>
                                <span class="fs-5 ms-2 bg-light px-2 py-1 fakebtn">{{
                                  formatStartTime(session.startTime)
                                  }}</span></span>
                              <span class="my-0 d-flex"><i class="d-flex align-items-center">for about</i>
                                <span class="fs-5 ms-2 me-1 bg-light px-2 py-1 fakebtn">{{ session.duration
                                  }}
                                  hours</span></span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Checkpoint Day -->
                <div *ngIf="day.type === 'CheckpointDay'" class="row single-day my-0 pt-5 pb-5">
                  
                  <div class="col ps-5">
                    <h3 class="fw-bold text-center">{{ day.name }} - Checkpoint</h3>
                    <form [formGroup]="formGroup" (ngSubmit)="submitCheckpointAnswers(day)">
                      <div class="checkpoint-form-container p-3">
                        <p *ngFor="let question of day.questions" class="my-4">
                          <ng-container *ngIf="question.questionType === 'CHECKPOINT'">
                            {{ question.questionText }}
                            <div class="conceal-radio d-flex justify-content-center border border-1 border-black mb-2">
                              <input class="me-2" type="radio" [formControlName]="question.id.toString()"
                                [value]="false" (change)="onAnswerChange(day, question, false)" />
                              <label class="d-flex align-items-center justify-content-center p-3"> No</label>
                            </div>
                            <div class="conceal-radio d-flex justify-content-center border border-1 border-black">
                              <input class="me-2" type="radio" [formControlName]="question.id.toString()" [value]="true"
                                (change)="onAnswerChange(day, question, true)" />
                              <label class="d-flex align-items-center justify-content-center p-3"> Yes</label>
                            </div>

                          </ng-container>
                        </p>

                        <button type="submit" [disabled]="!canSubmitAnswers(day)"
                          class="text-uppercase btn btn-dark rounded-pill px-3 py-2 mt-3 w-100 d-block">
                          Submit Answers
                        </button>

                        <p *ngIf="submissionStatus[day.name] === true" class="mt-3 mb-0 text-success text-center">
                          Answers
                          correctly submitted</p>

                        <p *ngIf="submissionStatus[day.name] === false" class="mt-3 mb-0 text-danger text-center">You
                          already submitted answers for this day</p>
                      </div>
                    </form>
                  </div>
                  <div class="col p-0">
                    <h3 class="fw-bold text-center mt-3">&nbsp;</h3>

                    <p *ngFor="let question of day.questions" class="mb-0 d-flex justify-content-center">
                      <ng-container *ngIf="question.questionType === 'RESTART'">
                        <button (click)="confirmRestart(day, question)" class="text-uppercase btn rounded-pill d-block"
                          id="avatarFit">Your avatar doesn't fit you anymore?</button>
                      </ng-container>
                    </p>
                  </div>
                </div>

                <!-- Deadline Day -->
                <div *ngIf="day.type === 'DeadlineDay'" class="row single-day my-0 pt-5 pb-5">
                  
                  <div class="col ps-5">
                    <h3 class="fw-bold text-center">{{ day.name }} - Deadline</h3>
                    <form [formGroup]="formGroup" (ngSubmit)="submitDeadlineAnswers(day)">

                      <div class="p-3 deadline-form-container">
                        <div *ngIf="hasAnswers(day)">
                          <p *ngFor="let question of day.questions" class="my-4">
                            <ng-container *ngIf="question.questionType === 'DEADLINE'">
                              {{ question.questionText }}

                              <div
                                class="conceal-radio d-flex justify-content-center border border-1 border-black mb-2">
                                <input class="me-2" type="radio" [formControlName]="question.id.toString()"
                                  [value]="false" (change)="onAnswerChange(day, question, false)" />
                                <label class="d-flex align-items-center justify-content-center p-3"> No</label>
                              </div>
                              <div class="conceal-radio d-flex justify-content-center border border-1 border-black">
                                <input class="me-2" type="radio" [formControlName]="question.id.toString()"
                                  [value]="true" (change)="onAnswerChange(day, question, true)" />
                                <label class="d-flex align-items-center justify-content-center p-3"> Yes</label>
                              </div>
                            </ng-container>
                          </p>

                          <button type="submit" [disabled]="!canSubmitAnswers(day)"
                            class="text-uppercase btn btn-dark rounded-pill px-3 py-2 mt-3 w-100 d-block">
                            Submit Answers
                          </button>

                          <p *ngIf="submissionStatus[day.name] === true" class="mt-3 mb-0 text-success text-center">
                            Answers
                            correctly submitted</p>
                        </div>
                        <p *ngIf="submissionStatus[day.name] === false" class="mt-3 mb-0 text-danger text-center">You
                          already submitted answers for this day</p>

                      </div>
                    </form>
                  </div>
                  <div class="col p-0">
                    <h3 class="fw-bold text-center mt-3">&nbsp;</h3>

                    <p *ngFor="let question of day.questions" class="mb-0 d-flex justify-content-center">
                      <ng-container *ngIf="question.questionType === 'RESTART'">
                        <button (click)="confirmRestart(day, question)" class="text-uppercase btn rounded-pill d-block mt-4"
                          id="avatarFit">Your avatar doesn't fit you anymore?</button>
                      </ng-container>
                    </p>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

      </div>

      <div *ngIf="!studyPlan">
        <p>No study plan found for this user.</p>
      </div>
    </div>

    <div *ngIf="isLoading">
      <p>Loading study plan...</p>
    </div>
  </div>
</div>